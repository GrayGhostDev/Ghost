source_env_if_exists() { [ -f "$1" ] && . "$1"; }

# Handle Proxyman SSL certificate conflicts
# Save original SSL env vars if they exist
if [ -n "${CURL_CA_BUNDLE:-}" ] && [[ "$CURL_CA_BUNDLE" == *"proxyman"* ]]; then
    export PROXYMAN_CURL_CA_BUNDLE="$CURL_CA_BUNDLE"
    export GHOST_PROXYMAN_ACTIVE=1
fi

# Function to temporarily disable Proxyman SSL for system operations
disable_proxyman_ssl() {
    if [ "${GHOST_PROXYMAN_ACTIVE:-}" = "1" ]; then
        unset CURL_CA_BUNDLE SSL_CERT_DIR SSL_CERT_FILE
        export GHOST_SSL_DISABLED=1
    fi
}

# Function to restore Proxyman SSL settings
restore_proxyman_ssl() {
    if [ "${GHOST_SSL_DISABLED:-}" = "1" ]; then
        [ -n "${PROXYMAN_CURL_CA_BUNDLE:-}" ] && export CURL_CA_BUNDLE="$PROXYMAN_CURL_CA_BUNDLE"
        unset GHOST_SSL_DISABLED
    fi
}

source_env_if_exists ./scripts/macports/env_helpers.sh
source_env_if_exists ./scripts/secrets/runtime_env.sh
